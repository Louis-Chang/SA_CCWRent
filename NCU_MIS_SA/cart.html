<!DOCTYPE HTML>
<!--
	Linear by TEMPLATED
    templated.co @templatedco
    Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>

<head>
    <title>您的預訂車輛</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,300,700,500,900' rel='stylesheet' type='text/css'>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/skel.min.js"></script>
    <script src="js/skel-panels.min.js"></script>
    <script src="js/init.js"></script>
    <noscript>
			<link rel="stylesheet" href="css/skel-noscript.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-desktop.css" />
		</noscript>
	<script src="statics/js/jquery-3.4.1.min.js"></script>
 	<script src="statics/js/jquery-confirm.js"></script>
</head>

<body>

    <!-- Header -->
    <div id="header">
        <div id="nav-wrapper">
            <!-- Nav -->
            <nav id="nav">
                <ul>
                    <li class="active"><a href="index.html">首頁</a></li>
                    <li><a href="about.html">關於CCW Rent</a></li>
                    <li><a href="cars.html">車輛資訊</a></li>
                    <li><a href="store.html">據點查詢</a></li>
                    <li><a href="notice.html">注意事項</a></li>
                </ul>
                <!--input type="button" onclick="javascript:location.href='login.html'" value="Login" style="position: absolute; right: 40px; top: 20px; color: white; display: inline-block; background: #80BA8E;"-->
            </nav>
        </div>
        <div class="container">

            <!-- Logo -->
            <div id="logo">
                <a href="#" style="color: rgba(0, 0, 0, 0);">CCW RENT</a>
            </div>
        </div>
    </div>
    <!-- Header -->

    <!-- Main -->
    <div id="main">
        <div id="content" class="container">
            <section>
                <header>
                    <h2><a href="index.html">首頁</a>／您的預訂車輛</h2>
                    <h3><br>以下是以下是您欲預訂的車輛，請輸入訂單相關資訊後即可送出訂單！</h3>
                </header>

                <body>
                    <table style="width: 50%; padding: 8px;">
                        <tr>
                            <td>
                                <form>
                                    取車地點：
                                    <select id="rentlocation" name="getLoc">
										<option value="台北 大安森林公園站">台北 大安森林公園站</option>
										<option value="台北 台北101站">台北 台北101站</option>
										<option value="台北 內湖站">台北 內湖站</option>
										<option value="台北 中正紀念堂站">台北 中正紀念堂站</option>
										<option value="台北 行天宮站">台北 行天宮站</option>
										<option value="桃園 桃園藝文特區站">桃園 桃園藝文特區站</option>
										<option value="桃園 台茂站">桃園 台茂站</option>
										<option value="桃園 高鐵桃園站">桃園 高鐵桃園站</option>
										<option value="桃園 平鎮區公所站">桃園 平鎮區公所站</option>
										<option value="台中 西屯站">台中 西屯站</option>
										<option value="台中 南屯站">台中 南屯站</option>
										<option value="台中 豐原站">台中 豐原站</option>
										<option value="台中 清水站">台中 清水站</option>
										<option value="台南 玉井站">台南 玉井站</option>
										<option value="台南 永康站">台南 永康站</option>
										<option value="台南 安平站">台南 安平站</option>
										<option value="高雄 苓雅站">高雄 苓雅站</option>
										<option value="高雄 三民站">高雄 三民站</option>
										<option value="高雄 左營站">高雄 左營站</option>
										<option value="高雄 前鎮站">高雄 前鎮站</option>
										<option value="高雄 鹽埕站">高雄 鹽埕站</option>
									</select>
                                </form>
                            </td>
                            <td>
                                <form>
                                    還車地點：
                                    <select id="backlocation" name="getLoc">
										<option value="台北 大安森林公園站">台北 大安森林公園站</option>
										<option value="台北 台北101站">台北 台北101站</option>
										<option value="台北 內湖站">台北 內湖站</option>
										<option value="台北 中正紀念堂站">台北 中正紀念堂站</option>
										<option value="台北 行天宮站">台北 行天宮站</option>
										<option value="桃園 桃園藝文特區站">桃園 桃園藝文特區站</option>
										<option value="桃園 台茂站">桃園 台茂站</option>
										<option value="桃園 高鐵桃園站">桃園 高鐵桃園站</option>
										<option value="桃園 平鎮區公所站">桃園 平鎮區公所站</option>
										<option value="台中 西屯站">台中 西屯站</option>
										<option value="台中 南屯站">台中 南屯站</option>
										<option value="台中 豐原站">台中 豐原站</option>
										<option value="台中 清水站">台中 清水站</option>
										<option value="台南 玉井站">台南 玉井站</option>
										<option value="台南 永康站">台南 永康站</option>
										<option value="台南 安平站">台南 安平站</option>
										<option value="高雄 苓雅站">高雄 苓雅站</option>
										<option value="高雄 三民站">高雄 三民站</option>
										<option value="高雄 左營站">高雄 左營站</option>
										<option value="高雄 前鎮站">高雄 前鎮站</option>
										<option value="高雄 鹽埕站">高雄 鹽埕站</option>
									</select>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <form action="/action_page.php">
                                    取車日期： <input type="date" id="rentday">
                                </form>
                            </td>
                            <td>
                                <form action="/action_page.php">
                                    還車日期： <input type="date" id="backday">
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" id="rent_carname">
                                您預定的車型為：
			          <label style="color:black; font-size: 20px">
			          </label>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" id="rent_money">
                            <input type="button" onclick="calRentMoney()" value="租金試算" style="display: inline-block;">
           	 ：            
           			  <label style="color:blue; font-size: 20px">
			          </label>
                            </td>
                        </tr>
                    </table>   
                    <input type="button" onclick="cancelRent()" value="取消" style="position: absolute; right: 100px; bottom: 20px; color: white; display: inline-block; background: #80BA8E;">
                    <input type="button" onclick="checkRent()" value="預訂" style="position: absolute; right: 40px; bottom: 20px; color: white; display: inline-block; background: #80BA8E;">
                </body>
            </section>
        </div>
    </div>
    <!-- /Main -->

    <!-- Tweet -->
    <div id="tweet">
        <div class="container" style="color: white; font-size: 20px;">
            <section>
                <p>全台據點隨你搜<br>現在就來CCW RENT一下吧</p>
            </section>
        </div>
    </div>
    <!-- /Tweet -->

    <!-- Footer -->
    <div id="footer">
        <div class="container">
            <section>
                <header>
                    <h2>聯絡方式</h2>
                    <span class="byline"> <br>Survice phone number      0975376458</span>
                </header>
                <ul class="contact">
                    <li><a href="#" class="fa fa-twitter"><span>Twitter</span></a></li>
                    <li class="active"><a href="#" class="fa fa-facebook"><span>Facebook</span></a></li>
                    <li><a href="#" class="fa fa-dribbble"><span>Pinterest</span></a></li>
                    <li><a href="#" class="fa fa-tumblr"><span>Google+</span></a></li>
                </ul>
            </section>
        </div>
    </div>


    
      <script>
    var [client_cart_obj, client_cart_amount]  = getCartDataFromClient();
    var rentdata;
	var rentname;
	var rentday;
	var price;
	var totalprice;
    var userdata = [];
    getUserData();

    if (client_cart_obj.length == 0) {
    	alert("沒有選擇租賃車輛！");
    	calcSummaryInformation();
    	setButtonState("check", false);
    }
    else {
    	getCartProduct();
    }
    
    
    function checkRent(){
    	console.log(userdata);
    	
    	var data = {
    			"name": userdata.name,
    			"email": userdata.email,
    			"phone": userdata.mobilephone,
    			"IDnumber": userdata.IDNumber,
    			"carName": rentname,
    			"totalPrice": totalprice,
    			"rentlocation": $("#rentlocation").val(),
    			"backlocation": $("#backlocation").val(),
    			"rentdate": $("#rentday").val(),
    			"backdate": $("#backday").val(),
    			"address": userdata.address,
    			"item": client_cart_obj,
    			"quantity": client_cart_amount
    	}
    	
    	var data_string = JSON.stringify(data);
    	console.log(data_string);
    	
        $.ajax({
            type: "POST",
            url: "api/order.do",
            data: data_string,
            crossDomain: true,
            cache: false,
            dataType: 'json',
            timeout: 100000,
            success: function (response) {
                if(response.status == 200){
                	updateCartDataToLocal();
                	alert("預訂成功！");
                	document.location.href = "order.html";
                	client_cart_obj = [];
                 	client_cart_amount = [];
                    updateCartDataToClent();
                }
            },
            error: function () {
                alert("無法連線到伺服器！");
            }
          });

    }
    
    //從local端取得用戶資料
    function getUserData() {
    	let userdata = JSON.parse(localStorage.getItem("User_data"));
    	userdata = !userdata ? new Array() : userdata;
    	let data = JSON.parse(userdata);
    	this.userdata = data;
    	return [userdata];
    }
    

    <!-- 計算租車租金 -->
    function calRentMoney() {
    	 var rentday = document.getElementById("rentday").value;
    	 var backday = document.getElementById("backday").value;
    	 var date_diff_indays = function(rentday, backday) {
    		 dt1 = new Date(rentday);
    		 dt2 = new Date(backday);
    		 return Math.floor((Date.UTC(dt2.getFullYear(), dt2.getMonth(), dt2.getDate()) - Date.UTC(dt1.getFullYear(), dt1.getMonth(), dt1.getDate()) ) /(1000 * 60 * 60 * 24));
    		}
    	 updateRentMoney(this.rentdata, date_diff_indays(rentday, backday));
    	}
    
    <!-- 取消訂單 -->
    function cancelRent() {
    	console.log("[@Action]清空購物車");
    	cleanAllData();
    }  
    
    function cleanAllData() {
    	client_cart_obj = [];
     	client_cart_amount = [];
        updateCartDataToClent();
        $("#rent_carname > label").empty();
        $("#rent_money > label").empty();
  		alert("沒有選擇租賃車輛！");
  		document.location.href = "cars.html";
    }
    
    function updateCartDataToClent() {
    	localStorage.setItem("client_cart_obj", JSON.stringify(client_cart_obj));
    	localStorage.setItem("client_cart_amount", JSON.stringify(client_cart_amount));
    }

    <!-- 取得使用者租賃之車輛 -->
    function getCartProduct() {
      $.ajax({
        type: "GET",
        url: "api/product.do",
        crossDomain: true,
        cache: false,
        data: "id_list=" + client_cart_obj.toString(),
        dataType: 'json',
        timeout: 100000,
        success: function (response) {
          if (response.status == 200) {
        	  updateRentCarName(response.response.data);
        	  setRentData(response.response.data);
          }
        },
        error: function () {
          alert("無法連線到伺服器！");
        }
      });
    }
    
    
    function setRentData(data){
    	this.rentdata = data;
    }

    <!-- 更新租車車輛名 -->
    function updateRentCarName(data) {
    	table_html = '';
    	this.rentname =  data[0].name;
    	$("#rent_carname > label").empty();
        $.each(data, function(index, value) {
        	table_html += value.name;
        })
      $("#rent_carname > label").append(table_html);
    }
    
    <!-- 更新租車金額 -->
    function updateRentMoney(data, date) {
    	var totalmoney = data[0].price * date;
    	this.price = data[0].price;
    	this.totalprice = totalmoney.toString();
    	this.rentday = date;
    	table_html = '';
    	$("#rent_money > label").empty();
        $.each(data, function(index, value) {		
        	table_html += "租賃 " + value.name +" " + date + "天，需" + totalmoney + "元！";
        })
      $("#rent_money > label").append(table_html);
    }
    
    function getCartDataFromClient() {
    	let cart = JSON.parse(localStorage.getItem("client_cart_obj"));
    	let amount = JSON.parse(localStorage.getItem("client_cart_amount"));
    	cart = !cart ? new Array() : cart;
    	amount = !amount ? new Array() : amount;
    	return [cart, amount];
    }
    

    
    
    function updateCartDataToLocal(){
    	var data = {
				"rentname":rentname,
				"rentday":rentday,
				"price":price,
				"totalprice":totalprice,
    			"rentlocation": $("#rentlocation").val(),
    			"backlocation": $("#backlocation").val(),
    			"rentdate": $("#rentday").val(),
    			"backdate": $("#backday").val(),
    	}

    	var data_string = JSON.stringify(data);
    	console.log(data_string);
    	localStorage.setItem("Cart_Data", JSON.stringify(data_string));
    }
    

    

  </script>


</body>

</html>